---
name: Nomad CLI install only
description: Hashicorp Nomad download specific version binary to $PATH

inputs:
  version:
    description: Nomad version. If empty, used latest version
    required: false
    default: latest

runs:
  using: composite
  steps:
    - name: Download specific version Nomad binary
      if: ${{ inputs.version != 'latest' }}
      run: |
          sudo apt-get install wget unzip -y
          wget https://releases.hashicorp.com/nomad/${{ inputs.version }}/nomad_${{ inputs.version }}_linux_amd64.zip -O /tmp/nomad.zip
      shell: bash

    - name: Download latest version Nomad binary
      if: ${{ inputs.version == 'latest' }}
      run: |
          sudo apt-get install unzip -y
          LATEST_VERSION=$( curl -s https://api.github.com/repos/hashicorp/nomad/releases/latest | jq -r .tag_name | sed 's/v//' )
          wget https://releases.hashicorp.com/nomad/${LATEST_VERSION}/nomad_${LATEST_VERSION}_linux_amd64.zip -O /tmp/nomad.zip
      shell: bash

    - name: Install Nomad binary
      run: |
        unzip /tmp/nomad.zip -d /usr/local/bin
        chmod +x /usr/local/bin/nomad
      shell: bash

branding:
  icon: 'upload-cloud'
  color: 'green'