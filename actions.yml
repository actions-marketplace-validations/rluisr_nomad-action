name: Nomad client only
description: Hashicorp Nomad download specific version binary to $PATH
inputs:
  token:
    description: Token used to authenticate with a Nomad server
    required: false
  http_auth:
    description: Basic Authentication for a Nomad server
    required: false
  addr:
    description: Address of the nomad server
    required: true
  version:
    description: Nomad version. If empty, used latest version
    required: false
    default: latest

runs:
  using: composite
  steps:
    - name: Download specific version Nomad binary
      if: ${{ inputs.version != 'latest' }}
      run: |
          sudo apt-get install wget unzip -y
          wget https://releases.hashicorp.com/nomad/${{ inputs.version }}/nomad_${{ inputs.version }}_linux_amd64.zip -O /tmp/nomad.zip
          unzip /tmp/nomad.zip -d /usr/bin
      shell: bash

    - name: Download latest version Nomad binary
      if: ${{ inputs.version != 'latest' }}
      run: |
          sudo apt-get install jq unzip -y
          LATEST_VERSION=$( curl -s https://api.github.com/repos/hashicorp/nomad/releases/latest | jq -r .tag_name | sed 's/v//' )
          wget https://releases.hashicorp.com/nomad/${LATEST_VERSION}/nomad_${LATEST_VERSION}_linux_amd64.zip -O /tmp/nomad.zip
          unzip /tmp/nomad.zip -d /usr/bin
      shell: bash

    - name: Set environment variables
      run: |
        export NOMAD_TOKEN="${{ inputs.token }}"
        export NOMAD_HTTP_AUTH="${{ inputs.http_auth }}"
        export NOMAD_ADDR="${{ inputs.addr }}"

branding:
  icon: 'upload-cloud'
  color: 'green'